/*! Rappid v3.0.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-08-09 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


this.joint=this.joint||{},function(t,c,f,h,d,v){"use strict";c=c&&c.hasOwnProperty("default")?c.default:c;var n=f.mvc.View.extend({className:"inspector",options:{cellView:void 0,cell:void 0,live:!0,validateInput:function(t,e,i,n){return!t.validity||t.validity.valid},renderFieldContent:void 0,renderLabel:void 0,operators:{},multiOpenGroups:!0,stateKey:function(t){return t.id}},events:{"change [data-attribute]:not([data-custom-field])":"onChangeInput","click .group-label":"onGroupLabelClick","click .btn-list-add":"addListItem","click .btn-list-del":"deleteListItem","mousedown .field":"pointerdown","touchstart .field":"pointerdown","focusin .field":"pointerfocusin","focusout .field":"pointerfocusout"},HTMLEntities:{lt:"<",gt:">",amp:"&",nbsp:" ",quot:'"',cent:"¢",pound:"£",euro:"€",yen:"¥",copy:"©",reg:"®"},init:function(){var t=this.options.groups=this.options.groups||{};f.util.bindAll(this,"stopBatchCommand","pointerup","onContentEditableBlur","replaceHTMLEntity"),this.widgets={},this._attributeKeysInUse=[],this.flatAttributes=this.flattenInputs(this.options.inputs),this.expandAttributes=this.expandAttrs(this.options.inputs||{}),this._when={},this._bound={};var e=Object.keys(this.flatAttributes).map(function(t){var e=this.flatAttributes[t];if(e.when){var i={expression:e.when,path:t};this.extractExpressionPaths(i.expression).forEach(function(t){(this._when[t]||(this._when[t]=[])).push(i)},this)}return this.needsResolving(e)&&(this._bound[t]=e.options),e.path=t,e},this);for(var i in t){var n=t[i];n&&t.hasOwnProperty(i)&&this.extractExpressionPaths(n.when).forEach(function(t){this._when[t]||(this._when[t]=[])},this)}var s=f.util.sortBy(e,"index");this.groupedFlatAttributes=f.util.sortBy(s,function(t){var e=this.options.groups[t.group];return e&&e.index||Number.MAX_VALUE}.bind(this)),this.listenTo(this.getModel(),"all",this.onCellChange,this)},cacheInputs:function(){var n={};Array.from(this.$("[data-attribute]")).forEach(function(t){var e=c(t),i=e.attr("data-attribute");n[i]=e},this),this._byPath=n,this._attributeKeysInUse=this.getAttributeKeysInUse()},updateGroupsVisibility:function(){for(var t=this.$groups,e=0,i=t.length;e<i;e++){var n=c(t[e]),s=n.attr("data-name"),r=this.options.groups[s],o=0===n.find("> .field:not(.hidden)").length;n.toggleClass("empty",o);var a=!(!r||!r.when||this.isExpressionValid(r.when));n.toggleClass("hidden",a)}},expandAttrs:function(t){for(var e={},i=Object.keys(t),n=0;n<i.length;n++){var s=i[n],r=t[s],o=s.split("/");f.util.setByPath(e,o,f.util.isPlainObject(r)?this.expandAttrs(r):r)}return e},flattenInputs:function(t){return f.util.flattenObject(t,"/",function(t){return"string"==typeof t.type})},getModel:function(){return this.options.cell||this.options.cellView.model},onCellChange:function(t,e,i,n){if((n=n||{}).inspector!=this.cid)switch(t){case"remove":this.remove();break;case"change:position":this.updateInputPosition();break;case"change:size":this.updateInputSize();break;case"change:angle":this.updateInputAngle();break;case"change:source":case"change:target":case"change:vertices":break;default:var s="change:";if(t.slice(0,s.length)===s){var r=t.slice(s.length);this._attributeKeysInUse.includes(r)&&this.render({refresh:!0})}}},render:function(t){var i,n=t&&t.refresh;n&&this.options.storeGroupsState&&this.storeGroupsState(),this.$el.empty(),this.removeWidgets();var s,r=[];return this.groupedFlatAttributes.forEach(function(t){if(i!==t.group){var e=this.options.groups[t.group];s=this.renderGroup({name:t.group,label:e&&e.label}),n||(e&&e.closed?this.closeGroup(s,{init:!0}):this.openGroup(s,{init:!0})),r.push(s)}this.renderTemplate(s,t,t.path),i=t.group},this),this.$document=c(this.el.ownerDocument),this.$groups=c(r),this.$el.append(r),n&&this.options.restoreGroupsState&&this.restoreGroupsState(),this.afterRender(),this},getAttributeKeysInUse:function(){var t=Object.keys(this._byPath).map(function(t){return t.substring(0,t.indexOf("/"))||t}),e=f.util.toArray(this._bound),i=Object.keys(this._when);return f.util.uniq([].concat(t,e,i))},getCellAttributeValue:function(t,e){var i=this.getModel(),n=f.util.getByPath(i.attributes,t,"/");if(!(e=e||this.flatAttributes[t]))return n;if(void 0===n&&void 0!==e.defaultValue&&(n=e.defaultValue),e.valueRegExp){if(void 0===n)throw new Error("Inspector: defaultValue must be present when valueRegExp is used.");var s=n.match(new RegExp(e.valueRegExp));n=s&&s[2]}return n},resolvableTypes:["select","select-box","color-palette","select-button-group"],needsResolving:function(t){return!!t&&-1<this.resolvableTypes.indexOf(t.type)&&f.util.isString(t.options)},resolveBindings:function(t){if(-1<this.resolvableTypes.indexOf(t.type)){var e=t.options||[];f.util.isString(e)&&(e=f.util.getByPath(this.getModel().attributes,e,"/")||[]),f.util.isObject(e[0])||(e=f.util.toArray(e).map(function(t){return{value:t,content:t}})),t.items=e}},updateBindings:function(n){var t=Object.keys(this._bound).reduce(function(t,e){var i=this._bound[e];return 0===n.indexOf(i)&&t.push(e),t}.bind(this),[]);f.util.isEmpty(t)||(t.forEach(function(t){this.renderTemplate(null,this.flatAttributes[t],t,{replace:!0})},this),this.afterRender())},renderFieldContent:function(s,t,r){var e,o,a,u,i;if(f.util.isFunction(this.options.renderFieldContent)&&(e=this.options.renderFieldContent(s,t,r,this)))return c(e).attr({"data-attribute":t,"data-type":s.type,"data-custom-field":!0});switch(s.type){case"select-box":a=f.util.toArray(s.items).findIndex(function(t){var e=t.value,i=r;if(void 0===e&&t.content===i)return!0;var n=s.key;return n&&(i=f.util.getByPath(i,n,"/"),e=f.util.getByPath(e,n,"/")),f.util.isEqual(e,i)});var n=f.util.assign({theme:this.options.theme},f.util.omit(s,"type","group","index","selectBoxOptionsClass","options"),{options:s.items,selected:a,selectBoxOptionsClass:[f.util.addClassNamePrefix("inspector-select-box-options"),s.selectBoxOptionsClass].filter(function(t){return!!t}).join(" ")});(o=new h.SelectBox(n)).$el.attr({"data-attribute":t,"data-type":s.type,"data-overwrite":s.overwrite}),o.render(),i=this.renderOwnLabel(s,t),e=c("<div/>").append(i,o.el),s.previewMode?(u=o.selection,o.on("options:mouseout close",function(){o.selection=u,this.processInput(o.$el,{previewCancel:!0,dry:!0})},this),o.on("option:hover",function(t,e){o.selection=t,this.processInput(o.$el,{dry:!0})},this),o.on("option:select",function(t,e){var i=void 0===u?void 0:o.getSelectionValue(u),n=i===o.getSelectionValue(t);this.processInput(o.$el,{previewDone:!0,dry:n,originalValue:i}),u=t},this)):o.on("option:select",function(t,e){this.processInput(o.$el)},this),this.widgets[t]=o;break;case"color-palette":a=f.util.toArray(s.items).findIndex(function(t){return t.value===r||void 0===t.value&&t.content===r});var l=f.util.assign({theme:this.options.theme},f.util.omit(s,"type","group","index","options"),{options:s.items,selected:a});(o=new v.ColorPalette(l)).$el.attr({"data-attribute":t,"data-type":s.type}),o.render(),i=this.renderOwnLabel(s,t),e=c("<div/>").append(i,o.el),s.previewMode?(u=o.selection,o.on("options:mouseout close",function(){o.selection=u,this.processInput(o.$el,{previewCancel:!0,dry:!0})},this),o.on("option:hover",function(t,e){o.selection=t,this.processInput(o.$el,{dry:!0})},this),o.on("option:select",function(t,e){var i=void 0===u?void 0:o.getSelectionValue(u),n=i===o.getSelectionValue(t);this.processInput(o.$el,{previewDone:!0,dry:n,originalValue:i}),u=t},this)):o.on("option:select",function(t,e){this.processInput(o.$el)},this),this.widgets[t]=o;break;case"select-button-group":s.multi?(a=[],f.util.toArray(s.items).forEach(function(t,e){var i=void 0===t.value?t.content:t.value,n=s.key;n&&(i=f.util.getByPath(i,n,"/")),f.util.toArray(r).find(function(t){return n&&(t=f.util.getByPath(t,n,"/")),f.util.isEqual(i,t)})&&a.push(e)})):a=f.util.toArray(s.items).findIndex(function(t){var e=t.value,i=r;if(void 0===e&&t.content===i)return!0;var n=s.key;return n&&(i=f.util.getByPath(i,n,"/"),e=f.util.getByPath(e,n,"/")),f.util.isEqual(e,i)});var p=f.util.assign({theme:this.options.theme},f.util.omit(s,"type","group","index","options"),{options:s.items,selected:a});(o=new d.SelectButtonGroup(p)).$el.attr({"data-attribute":t,"data-type":s.type,"data-overwrite":s.overwrite}),o.render(),i=this.renderOwnLabel(s,t),e=c("<div/>").append(i,o.el),s.previewMode?(u=o.selection,o.on("mouseout",function(){o.selection=u,this.processInput(o.$el,{previewCancel:!0,dry:!0})},this),o.on("option:hover",function(t,e){s.multi?o.selection=f.util.uniq(o.selection.concat([t])):o.selection=t,this.processInput(o.$el,{dry:!0})},this),o.on("option:select",function(t,e){var i=void 0===u?void 0:o.getSelectionValue(u),n=o.getSelectionValue(t),s=f.util.isEqual(i,n);this.processInput(o.$el,{previewDone:!0,dry:s,originalValue:i}),u=t},this)):o.on("option:select",function(t,e){this.processInput(o.$el)},this),this.widgets[t]=o;break;default:e=this.renderOwnFieldContent({options:s,type:s.type,overwrite:s.overwrite,label:s.label||t,attribute:t,value:r})}return e},renderGroup:function(t){t=t||{};var e=c("<div/>").addClass("group").attr("data-name",t.name),i=c("<h3/>").addClass("group-label").text(t.label||t.name);return e.append(i)},renderOwnLabel:function(t,e){var i,n=this.options.renderLabel;if("function"==typeof n&&(i=n(t,e,this)),void 0!==i)return c(i);switch(t.type){case"select-box":case"color-palette":case"select-button-group":return c("<label/>").html(t.label||e);default:return c("<label/>").text(t.label||e)}},renderOwnFieldContent:function(i){var t,n,e,s,r,o,a;switch(a=this.renderOwnLabel(i.options,i.attribute),i.type){case"number":n=c("<input/>",{type:"number",min:i.options.min,max:i.options.max,step:i.options.step}).val(i.value),t=[a,c("<div/>").addClass("input-wrapper").append(n)];break;case"range":a.addClass("with-output"),e=c("<output/>").text(i.value),s=c("<span/>").addClass("units").text(i.options.unit),(n=c("<input/>",{type:"range",name:i.type,min:i.options.min,max:i.options.max,step:i.options.step}).val(i.value)).on("change input",function(){e.text(n.val())}),t=[a,e,s,n];break;case"textarea":n=c("<textarea/>").text(i.value),t=[a,c("<div/>").addClass("input-wrapper").append(n)];break;case"content-editable":var u=f.util.isString(i.value)?i.value.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"):"";n=c("<div/>").prop("contenteditable",!0).css("display","inline-block").html(u).on("blur",this.onContentEditableBlur),t=[a,c("<div/>").addClass("input-wrapper").append(n)];break;case"select":var l=i.options.items;n=c("<select/>"),i.options.multiple&&n.prop({size:i.options.size||l.length,multiple:!0});f.util.toArray(l).forEach(function(t){var e=c("<option/>",{value:t.value}).text(t.content);!function(e){return i.options.multiple?f.util.toArray(i.value).find(function(t){return f.util.isEqual(e,t)}):f.util.isEqual(e,i.value)}(t.value)||e.attr("selected","selected"),n.append(e)}),t=[a,n];break;case"toggle":r=c("<span><i/></span>"),n=c("<input/>",{type:"checkbox"}).prop("checked",!!i.value),t=[a,c("<div/>").addClass(i.type).append(n,r)];break;case"color":t=[a,n=c("<input/>",{type:"color"}).val(i.value)];break;case"text":n=c("<input/>",{type:"text"}).val(i.value),t=[a,c("<div/>").addClass("input-wrapper").append(n)];break;case"object":n=c("<div/>"),o=c("<div/>").addClass("object-properties"),t=[a,n.append(o)];break;case"list":r=c("<button/>").addClass("btn-list-add").text(i.options.addButtonLabel||"+"),o=c("<div/>").addClass("list-items"),t=[a,(n=c("<div/>")).append(r,o)]}return n&&n.addClass(i.type).attr({"data-type":i.type,"data-attribute":i.attribute,"data-overwrite":i.overwrite}),c.fn.append.apply(c("<div>"),t).children()},onContentEditableBlur:function(t){var e=c("<input/>",{disabled:!0,tabIndex:-1,style:{width:"1px",height:"1px",border:"none",margin:0,padding:0}}).appendTo(this.$el);e.focus(),e[0].setSelectionRange(0,0),e.blur().remove(),c(t.target).trigger("change")},replaceHTMLEntity:function(t,e){return this.HTMLEntities[e]||""},renderObjectProperty:function(t){return c("<div/>",{"data-property":(t=t||{}).property,class:"object-property"})},renderListItem:function(t){t=t||{};var e=c("<button/>").addClass("btn-list-del").text(t.options.removeButtonLabel||"-");return c("<div/>",{"data-index":t.index,class:"list-item"}).append(e)},renderFieldContainer:function(t){return c("<div/>",{"data-field":(t=t||{}).path,class:"field "+t.type+"-field"})},renderTemplate:function(t,n,s,e){t=t||this.$el,e=e||{},this.resolveBindings(n);var i=this.renderFieldContainer({path:s,type:n.type});n.when&&!this.isExpressionValid(n.when)&&(i.addClass("hidden"),n.when.otherwise&&n.when.otherwise.unset&&this.unsetProperty(s));var r=this.getCellAttributeValue(s,n),o=this.renderFieldContent(n,s,r);if(i.append(o),f.util.setAttributesBySelector(i,n.attrs),"list"===n.type){f.util.toArray(r).forEach(function(t,e){var i=this.renderListItem({index:e,options:n});this.renderTemplate(i,n.item,s+"/"+e),o.children(".list-items").append(i)},this);var a=r&&r.length,u=n&&n.min,l=n&&n.max;this.fixListButtons(o,a,u,l)}else if("object"===n.type){var p=this.flattenInputs(n.properties),c=Object.keys(p).map(function(t){var e=this[t];return e.path=t,e},p);(c=f.util.sortBy(c,function(t){return t.index})).forEach(function(t){var e=this.renderObjectProperty({property:t.path});this.renderTemplate(e,t,s+"/"+t.path),o.children(".object-properties").append(e)},this)}e.replace?t.find('[data-field="'+s+'"]').replaceWith(i):t.append(i)},updateInputPosition:function(){var t=this._byPath["position/x"],e=this._byPath["position/y"],i=this.getModel().get("position");t&&t.val(i.x),e&&e.val(i.y)},updateInputSize:function(){var t=this._byPath["size/width"],e=this._byPath["size/height"],i=this.getModel().get("size");t&&t.val(i.width),e&&e.val(i.height)},updateInputAngle:function(){var t=this._byPath.angle,e=this.getModel().get("angle");t&&t.val(e)},validateInput:function(t,e,i){switch(t){case"select-box":case"color-palette":var n=this.widgets[i];return!!n&&-1!==n.getSelectionIndex();case"select-button-group":return!!this.widgets[i];default:return this.options.validateInput(e,i,t,this)}},onChangeInput:function(t){t.target===t.currentTarget&&this.processInput(c(t.target))},processInput:function(t,e){var i=t.attr("data-attribute"),n=t.attr("data-type");if(this.validateInput(n,t[0],i)){this.options.live&&this.updateCell(t,i,e);var s=this.getFieldValue(t[0],n),r=this.parse(n,s,t[0]);this.trigger("change:"+i,r,t[0],e)}},updateDependants:function(t){f.util.toArray(this._when[t]).forEach(function(t){var e=this._byPath[t.path],i=e.closest(".field"),n=i.hasClass("hidden"),s=this.isExpressionValid(t.expression);i.toggleClass("hidden",!s),t.expression.otherwise&&t.expression.otherwise.unset&&this.options.live&&(s?n&&this.updateCell(e,t.path):(this.unsetProperty(t.path),this.renderTemplate(null,this.flatAttributes[t.path],t.path,{replace:!0}),this.afterRender()))},this)},unsetProperty:function(t,e){var i=this.getModel(),n=t.split("/"),s=n[0],r=n.slice(1).join("/");if((e=e||{}).inspector=this.cid,e["inspector_"+this.cid]=!0,"attrs"==t)i.removeAttr(r,e);else if(t==s)i.unset(s,e);else{var o=f.util.merge({},i.get(s)),a=f.util.unsetByPath(o,r,"/");i.set(s,a,e)}},getOptions:function(t){if(0!==t.length){var e=t.attr("data-attribute");return this.getOptionsFromPath(e)}},markForRemoval:function(t,e){var i=this.findParentListByPath(t);if(i){var n=t.substr(i.length+1),s=parseInt(n,10);Number.isFinite(s)&&(e.remove[i]=e.remove[i]||[],e.remove[i].includes(s)||e.remove[i].push(s))}},markForUpdate:function(t,e,i,n){var s=t.substr(n.length+1);e.update[n]&&f.util.setByPath(e.update[n].value,s,i,"/")},updateCell:function(t,e,i){var h=this.getModel(),n={};t?n[e]=t:n=this._byPath,this.startBatchCommand();var d={},v={update:{},remove:{}};f.util.forIn(n,function(t,e){if(!t.closest(".field").hasClass("hidden")){var i=t.attr("data-type"),n=t.attr("data-overwrite"),s="false"!==n&&void 0!==n,r=t.hasClass("remove");switch(i){case"list":case"object":r&&this.markForRemoval(e,v);break;default:if(!this.validateInput(i,t[0],e))return;var o=this.getFieldValue(t[0],i),a=this.parse(i,o,t[0]),u=this.getOptionsFromPath(e);if(u.valueRegExp)a=(f.util.getByPath(h.attributes,e,"/")||u.defaultValue).replace(new RegExp(u.valueRegExp),"$1"+a+"$3");if(r)this.markForRemoval(e,v);else{var l=u.parent;if(l&&"object"===l.type&&void 0!==l.overwrite&&!1!==l.overwrite){var p={},c=e.split("/");p[c[c.length-1]]=a,v.update[l.path]={value:p,overwrite:!0}}else d[e]={value:a,overwrite:s}}}}}.bind(this)),f.util.forIn(d,function(t,e){this.setProperty(e,t.value,f.util.assign({overwrite:t.overwrite},i)),this.updateBindings(e),this.updateDependants(e)}.bind(this)),f.util.sortBy(Object.keys(v.remove),function(t){return t.split("/").length}).reverse().forEach(function(t){var e=v.remove[t];this.removeProperty(t,e,f.util.assign({rewrite:!0},i))}.bind(this)),f.util.forIn(v.update,function(t,e){this.setProperty(e,this.compactDeep(t.value),f.util.assign({rewrite:!0,overwrite:t.overwrite},i)),this.updateBindings(e),this.updateDependants(e)}.bind(this)),this.updateGroupsVisibility(),this.stopBatchCommand()},compactDeep:function(t){return Array.isArray(t)?t.reduce(function(t,e){return e&&t.push(this.compactDeep(e)),t}.bind(this),[]):t},findParentListByPath:function(t){var e=t.split("/");e.pop();for(var i=e;i.length;){var n=this.getOptionsFromPath(i.join("/"));if(n&&"list"===n.type)return e.slice(0,i.length).join("/");i.pop()}return null},getOptionsFromPath:function(t){for(var e,i=t.split("/"),n=this.expandAttributes,s=[];i.length;){var r,o=r;if(n&&"object"===n.type?r="properties":(r=i.shift(),!i.length&&"list"!==n.type||(e=n,s.push(r))),r=!Number.isNaN(parseInt(r))&&"list"===n.type?"item":r,Object(n)!==n||!(r in n||n[t]))return{};n=n[r]||n[t]}return n=f.util.assign({},n),(e=f.util.assign({},e)).path=s.join("/"),o&&"properties"===o&&(e.type="object"),n.parent=e,n},getFieldValue:function(t,e){if(f.util.isFunction(this.options.getFieldValue)){var i=this.options.getFieldValue(t,e,this);if(i)return i.value}var n=c(t);switch(e){case"select-box":case"color-palette":case"select-button-group":var s=n.attr("data-attribute");return this.widgets[s].getSelectionValue();case"content-editable":return n.html().replace(/<br\s*\/*>/gi,"\n").replace(/(<(p|div)\s)/gi,"\n$1").replace(/(<([^>]+)>)/gi,"").replace(/&(\w+);/gi,this.replaceHTMLEntity).replace(/\n$/,"");default:return n.val()}},removeProperty:function(t,n,e){var i=this.getModel(),s=f.dia.Cell.prototype.prop,r=s.call(i,t);if(r){var o=r.reduce(function(t,e,i){return n.includes(i)||t.push(e),t},[]),a=this.flatAttributes[t];Array.isArray(o)&&0===o.length&&!a&&(o=null),s.call(i,t,o,e)}},setProperty:function(t,e,i){(i=i||{}).inspector=this.cid;var n=f.dia.Cell.prototype.prop,s=this.getModel(),r=i.overwrite||!1;if(i.previewDone&&n.call(s,t,i.originalValue,{rewrite:!0,silent:!0}),void 0===e)f.dia.Cell.prototype.removeProp.call(s,t,i);else{var o;if(f.util.isObject(e)&&!r){var a=n.call(s,t),u=Array.isArray(e)?[]:{};o=f.util.merge(u,a,e)}else o=f.util.clone(e);r&&(i.rewrite=!0),n.call(s,t,o,i)}},parse:function(t,e,i){switch(t){case"number":case"range":e=parseFloat(e);break;case"toggle":e=i.checked}return e},startBatchCommand:function(){if(!this.inBatch){this.inBatch=!0;var t=this.getModel();t instanceof f.dia.Cell&&t.startBatch("inspector",{cid:this.cid})}},stopBatchCommand:function(){if(this.inBatch){var t=this.getModel();t instanceof f.dia.Cell&&t.stopBatch("inspector",{cid:this.cid}),this.inBatch=!1}},afterRender:function(){this.cacheInputs(),this.updateGroupsVisibility(),this.trigger("render")},addListItem:function(t){var e=c(t.target).parent("[data-attribute]"),i=this.getOptions(e),n=e.children(".list-items"),s=n.children(".list-item"),r=s.last(),o=(0===r.length?-1:parseInt(r.attr("data-index"),10))+1,a=this.renderListItem({index:o,options:i}),u=e.attr("data-attribute")+"/"+o;this.renderTemplate(a,i.item,u),n.append(a),a.find("input:first").focus();var l=(s=n.children(".list-item")).not(".remove").length;this.fixListButtons(e,l,i.min,i.max),this.afterRender(),this.options.live&&this.updateCell()},deleteListItem:function(t){var e=c(t.target),i=e.closest("[data-attribute]"),n=this.getOptions(i),s=e.closest(".list-item");s.hide(),s.addClass("remove"),s.find("[data-field]").each(function(){c(this).hide().addClass("remove")}),s.find("[data-attribute]").each(function(){c(this).hide().addClass("remove")});var r=i.children(".list-items").children(".list-item").not(".remove").length;this.fixListButtons(i,r,n.min,n.max),this.afterRender(),this.options.live&&this.updateCell()},fixListButtons:function(t,e,i,n){var s,r,o=t.children(".btn-list-add");(s=e,"number"!=typeof(r=n)||"number"!=typeof s||s<r)?o.removeClass("hidden"):o.addClass("hidden");var a,u,l=t.children(".list-items").children(".list-item").children(".btn-list-del");(a=e,"number"!=typeof(u=i)||u<=0||!("number"!=typeof a||a<=0)&&u<a)?l.removeClass("hidden"):l.addClass("hidden")},bindDocumentEvents:function(){var t=this.getEventNamespace();this.$document.on("mouseup"+t+" touchend"+t,this.pointerup)},unbindDocumentEvents:function(){this.$document.off(this.getEventNamespace())},pointerdown:function(t){this.bindDocumentEvents(),this.startBatchCommand(),this._$activeField=c(t.currentTarget).addClass("is-in-action")},pointerup:function(){this.unbindDocumentEvents(),this.stopBatchCommand(),this._$activeField&&(this._$activeField.removeClass("is-in-action"),this._$activeField=null)},pointerfocusin:function(t){t.stopPropagation(),c(t.currentTarget).addClass("is-focused")},pointerfocusout:function(t){t.stopPropagation(),c(t.currentTarget).removeClass("is-focused")},onRemove:function(){this.unbindDocumentEvents(),this.removeWidgets(),this===this.constructor.instance&&(this.constructor.instance=null)},removeWidgets:function(){var t=this.widgets;for(var e in t)t[e].remove();this.widgets={}},onGroupLabelClick:function(t){t.preventDefault(),this.options.multiOpenGroups||this.closeGroups();var e=c(t.target).closest(".group");this.toggleGroup(e)},toggleGroup:function(t){var e=f.util.isString(t)?this.$('.group[data-name="'+t+'"]'):c(t);e.hasClass("closed")?this.openGroup(e):this.closeGroup(e)},closeGroup:function(t,e){e=e||{};var i=f.util.isString(t)?this.$('.group[data-name="'+t+'"]'):c(t);!e.init&&i.hasClass("closed")||(i.addClass("closed"),this.trigger("group:close",i.data("name"),e))},openGroup:function(t,e){e=e||{};var i=f.util.isString(t)?this.$('.group[data-name="'+t+'"]'):c(t);(e.init||i.hasClass("closed"))&&(i.removeClass("closed"),this.trigger("group:open",i.data("name"),e))},closeGroups:function(){for(var t=0,e=this.$groups.length;t<e;t++)this.closeGroup(this.$groups[t])},openGroups:function(){for(var t=0,e=this.$groups.length;t<e;t++)this.openGroup(this.$groups[t])},COMPOSITE_OPERATORS:["not","and","or","nor"],PRIMITIVE_OPERATORS:["eq","ne","regex","text","lt","lte","gt","gte","in","nin","equal"],_isComposite:function(t){return 0<f.util.intersection(this.COMPOSITE_OPERATORS,Object.keys(t)).length},_isPrimitive:function(t){var e=Object.keys(this.options.operators).concat(this.PRIMITIVE_OPERATORS);return 0<f.util.intersection(e,Object.keys(t)).length},_evalCustomPrimitive:function(t,e,i){return!!this.options.operators[t].apply(this,[this.getModel(),e].concat(i))},_evalPrimitive:function(e){return Object.keys(e).reduce(function(t,s){var r=e[s];return Object.keys(r).reduce(function(t,e){var i=r[e],n=this.getCellAttributeValue(e);if(f.util.isFunction(this.options.operators[s]))return this._evalCustomPrimitive(s,n,i);switch(s){case"eq":return i==n;case"ne":return i!=n;case"regex":return new RegExp(i).test(n);case"text":return!i||f.util.isString(n)&&-1<n.toLowerCase().indexOf(i);case"lt":return n<i;case"lte":return n<=i;case"gt":return i<n;case"gte":return i<=n;case"in":return Array.isArray(i)&&i.includes(n);case"nin":return Array.isArray(i)&&!i.includes(n);case"equal":return f.util.isEqual(i,n);default:return t}}.bind(this),!1)}.bind(this),!1)},_evalExpression:function(s){return this._isPrimitive(s)?this._evalPrimitive(s):Object.keys(s).reduce(function(t,e){var i=s[e];if("not"==e)return!this._evalExpression(i);var n=f.util.toArray(i).map(this._evalExpression,this);switch(e){case"and":return n.every(function(t){return!!t});case"or":return n.some(function(t){return!!t});case"nor":return!n.some(function(t){return!!t});default:return t}}.bind(this),!1)},_extractVariables:function(t){return Array.isArray(t)||this._isComposite(t)?f.util.toArray(t).reduce(function(t,e){return t.concat(this._extractVariables(e))}.bind(this),[]):f.util.toArray(t).reduce(function(t,e){return Object.keys(e)},[])},isExpressionValid:function(t){return t=f.util.omit(t,"otherwise","dependencies"),this._evalExpression(t)},extractExpressionPaths:function(t){var e=t&&t.dependencies||[];return t=f.util.omit(t,"otherwise","dependencies"),f.util.uniq(this._extractVariables(t).concat(e))},getGroupsStateKey:function(){if(f.util.isFunction(this.options.stateKey))return this.options.stateKey(this.getModel());throw new Error("Inspector: Option stateKey must be a function")},storeGroupsState:function(){var t=this.getGroupsStateKey(),e=f.util.toArray(this.$(".group.closed"));n.groupStates[t]=e.map(function(t){return c(t).attr("data-name")})},getGroupsState:function(){return n.groupStates[this.getGroupsStateKey()]},restoreGroupsState:function(){function t(i,t){f.util.forIn(t.options.groups,function(t,e){i(t,e)?this.closeGroup(e):this.openGroup(e)}.bind(t))}var i=this.getGroupsStateKey();n.groupStates[i]?t(function(t,e){return n.groupStates[i].includes(e)},this):t(function(t){return t.closed},this)}},{groupStates:{},instance:null,create:function(t,e){e=e||{},f.util.defaults(e,{restoreGroupsState:!0,storeGroupsState:!0});var i=e.cell||e.cellView.model,n=this.instance;return n&&n.getModel()===i||(n&&n.el.parentNode&&(e.storeGroupsState&&n.storeGroupsState(),n.updateCell(),n.remove()),n=new this(e).render(),this.instance=n,c(t).html(n.el),e.restoreGroupsState&&n.restoreGroupsState()),n},close:function(){var t=this.instance;t&&t.remove()}});t.Inspector=n}(this.joint.ui=this.joint.ui||{},$,joint,joint.ui,joint.ui,joint.ui);