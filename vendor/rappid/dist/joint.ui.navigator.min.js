/*! Rappid v3.0.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-08-09 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


this.joint=this.joint||{},function(t,o,a){"use strict";o=o&&o.hasOwnProperty("default")?o.default:o;var i=a.mvc.View.extend({className:"navigator",events:{mousedown:"startAction",touchstart:"startAction"},options:{paperConstructor:a.dia.Paper,paperOptions:{},zoomOptions:null,zoom:{min:.5,max:2},width:300,height:200,padding:10},init:function(){this.options.zoomOptions?this.options.zoom=a.util.assign({},this.options.zoom,this.options.zoomOptions):this.options.zoom&&(this.options.zoom=a.util.defaults({},this.options.zoom,this.constructor.prototype.options.zoom)),a.util.bindAll(this,"updateCurrentView","doAction","stopAction","scrollTo"),this.updateCurrentView=a.util.debounce(this.updateCurrentView,0);var t=this.options.paperScroller;t.$el.on("scroll.navigator",this.updateCurrentView);var i=this.sourcePaper=t.options.paper;this.listenTo(i,"resize",this.updatePaper),(this.targetPaper=new this.options.paperConstructor(a.util.merge({model:i.model,interactive:!1,frozen:!0},this.options.paperOptions))).$el.on({"mousedown.navigator":this.scrollTo,"touchstart.navigator":this.scrollTo}),o(document.body).on({"mousemove.navigator touchmove.navigator":this.doAction,"mouseup.navigator touchend.navigator":this.stopAction})},render:function(){if(this.targetPaper.$el.appendTo(this.el),this.targetPaper.unfreeze(),this.$currentView=o("<div>").addClass("current-view"),this.options.zoom){var t=o("<div>").addClass("current-view-control");this.$currentView.append(t)}return this.$el.append(this.$currentView).css({width:this.options.width,height:this.options.height,padding:this.options.padding}),this.updatePaper(this.sourcePaper.options.width,this.sourcePaper.options.height),this},updatePaper:function(t,i){var o=this.sourcePaper.options.origin,e=this.sourcePaper.scale(),s=this.options.width-2*this.options.padding,n=this.options.height-2*this.options.padding;t/=e.sx,i/=e.sy;var r=this.ratio=Math.min(s/t,n/i),a=o.x*r/e.sx,p=o.y*r/e.sy;t*=r,i*=r,this.targetPaper.setDimensions(t,i),this.targetPaper.setOrigin(a,p),this.targetPaper.scale(r,r),this.updateCurrentView()},updateCurrentView:function(){var t=this.ratio,i=this.sourcePaper.scale(),o=this.options.paperScroller,e=o.clientToLocalPoint(0,0),s=this.targetPaper.$el.position(),n=this.targetPaper.translate();n.ty=n.ty||0,this.currentViewGeometry={top:s.top+e.y*t+n.ty,left:s.left+e.x*t+n.tx,width:o.$el.innerWidth()*t/i.sx,height:o.$el.innerHeight()*t/i.sy},this.$currentView.css(this.currentViewGeometry)},startAction:function(t){t=a.util.normalizeEvent(t),this._action=o(t.target).hasClass("current-view-control")?"zooming":"panning",this._clientX=t.clientX,this._clientY=t.clientY},doAction:function(t){if(this._action){t=a.util.normalizeEvent(t);var i=this.sourcePaper.scale(),o=(t.clientX-this._clientX)*i.sx,e=(t.clientY-this._clientY)*i.sy;switch(this._action){case"panning":this.options.paperScroller.el.scrollLeft+=o/this.ratio,this.options.paperScroller.el.scrollTop+=e/this.ratio;break;case"zooming":var s=-o/this.currentViewGeometry.width;this.options.paperScroller.zoom(s,this.options.zoom)}this._clientX=t.clientX,this._clientY=t.clientY}},stopAction:function(){this._action=null},scrollTo:function(t){t=a.util.normalizeEvent(t);var i,o,e=this.targetPaper.translate();if(e.ty=e.ty||0,void 0===t.offsetX){var s=this.targetPaper.$el.offset();i=t.pageX-s.left,o=t.pageY-s.top}else i=t.offsetX,o=t.offsetY;var n=(i-e.tx)/this.ratio,r=(o-e.ty)/this.ratio;this.options.paperScroller.center(n,r)},onRemove:function(){this.targetPaper.$el.off(".navigator"),this.targetPaper.remove(),this.options.paperScroller.$el.off(".navigator"),o(document.body).off(".navigator")}});t.Navigator=i}(this.joint.ui=this.joint.ui||{},$,joint);