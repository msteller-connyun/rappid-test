/*! Rappid v3.0.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-08-09 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


this.joint=this.joint||{},function(t,n,b){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var i=b.mvc.View.extend({className:"paper-scroller",options:{paper:void 0,padding:function(){var t=this.getClientSize(),i=Math.max(this.options.minVisiblePaperSize,1)||1,n={};return n.left=n.right=Math.max(t.width-i,0),n.top=n.bottom=Math.max(t.height-i,0),n},minVisiblePaperSize:50,autoResizePaper:!1,baseWidth:void 0,baseHeight:void 0,contentOptions:void 0,cursor:"default"},_padding:{left:0,top:0},init:function(){b.util.bindAll(this,"startPanning","stopPanning","pan","onBackgroundEvent");var t=this.options.paper,i=t.scale();this._sx=i.sx,this._sy=i.sy,void 0===this.options.baseWidth&&(this.options.baseWidth=t.options.width),void 0===this.options.baseHeight&&(this.options.baseHeight=t.options.height),this.$background=n("<div/>").addClass("paper-scroller-background").css({width:t.options.width,height:t.options.height}).append(t.el).appendTo(this.el),this.listenTo(t,"scale",this.onScale).listenTo(t,"resize",this.onResize).listenTo(t,"beforeprint beforeexport",this.storeScrollPosition).listenTo(t,"afterprint afterexport",this.restoreScrollPosition),this.options.autoResizePaper&&(t.isAsync()?this.listenTo(t,"render:done",this.onPaperRenderDone):this.listenTo(t.model,"change add remove reset",this.adjustPaper)),this.delegateBackgroundEvents(),this.setCursor(this.options.cursor)},onPaperRenderDone:function(t){t.priority<2&&this.adjustPaper()},lock:function(){return this.$el.css("overflow","hidden"),this},unlock:function(){return this.$el.css("overflow","scroll"),this},setCursor:function(t){switch(t){case"grab":this.$el.css("cursor","");break;default:this.$el.css("cursor",t)}return this.$el.attr("data-cursor",t),this.options.cursor=t,this},delegateBackgroundEvents:function(e){e=e||b.util.result(this.options.paper,"events");var t=this.paperEvents=Object.keys(e||{}).reduce(function(t,i){var n=e[i];-1===i.indexOf(" ")&&(t[i]=b.util.isFunction(n)?n:this.options.paper[n]);return t}.bind(this),{});return Object.keys(t).forEach(function(t){this.delegate(t,{guarded:!1},this.onBackgroundEvent)},this),this},onBackgroundEvent:function(t){if(this.$background.is(t.target)){var i=this.paperEvents[t.type];b.util.isFunction(i)&&i.apply(this.options.paper,arguments)}},onResize:function(){this._center&&this.center(this._center.x,this._center.y)},onScale:function(t,i,n,e){this.adjustScale(t,i),this._sx=t,this._sy=i,(n||e)&&this.center(n,e),"function"==typeof this.options.contentOptions&&this.adjustPaper()},storeScrollPosition:function(){this._scrollLeftBeforePrint=this.el.scrollLeft,this._scrollTopBeforePrint=this.el.scrollTop},restoreScrollPosition:function(){this.el.scrollLeft=this._scrollLeftBeforePrint,this.el.scrollTop=this._scrollTopBeforePrint,this._scrollLeftBeforePrint=null,this._scrollTopBeforePrint=null},beforePaperManipulation:function(){(b.env.test("msie")||b.env.test("msedge"))&&this.$el.css("visibility","hidden")},afterPaperManipulation:function(){(b.env.test("msie")||b.env.test("msedge"))&&this.$el.css("visibility","visible")},clientToLocalPoint:function(t,i){var n=this.options.paper.matrix();return t+=this.el.scrollLeft-this._padding.left-n.e,t/=n.a,i+=this.el.scrollTop-this._padding.top-n.f,i/=n.d,new b.g.Point(t,i)},localToBackgroundPoint:function(t,i){var n=new b.g.Point(t,i),e=this.options.paper.matrix(),s=this._padding;return b.V.transformPoint(n,e).offset(s.left,s.top)},adjustPaper:function(){var t=this.getClientSize();this._center=this.clientToLocalPoint(t.width/2,t.height/2);var i=this.options.contentOptions;"function"==typeof i&&(i=i.call(this,this));var n=b.util.assign({gridWidth:this.options.baseWidth,gridHeight:this.options.baseHeight,allowNewOrigin:"negative"},i);return this.options.paper.fitToContent(this.transformContentOptions(n)),this},adjustScale:function(t,i){var n=this.options.paper.options,e=t/this._sx,s=i/this._sy;this.options.paper.setOrigin(n.origin.x*e,n.origin.y*s),this.options.paper.setDimensions(n.width*e,n.height*s)},transformContentOptions:function(t){var i=this._sx,n=this._sy;return t.gridWidth&&(t.gridWidth*=i),t.gridHeight&&(t.gridHeight*=n),t.minWidth&&(t.minWidth*=i),t.minHeight&&(t.minHeight*=n),b.util.isObject(t.padding)?t.padding={left:(t.padding.left||0)*i,right:(t.padding.right||0)*i,top:(t.padding.top||0)*n,bottom:(t.padding.bottom||0)*n}:b.util.isNumber(t.padding)&&(t.padding=t.padding*i),t},center:function(t,i,n){var e,s=this.options.paper.matrix(),o=-s.e,r=-s.f,a=o+this.options.paper.options.width,h=r+this.options.paper.options.height,l=b.util.isNumber(t),c=b.util.isNumber(i);if(l||c){e=n;var p=this.getVisibleArea().center();l?t*=s.a:t=p.x,c?i*=s.d:i=p.y}else e=t,t=(o+a)/2,i=(r+h)/2;var d=this.getClientSize(),u=this.getPadding(),g=d.width/2,f=d.height/2,m=g-u.left-t+o,v=g-u.right+t-a,x=f-u.top-i+r,P=f-u.bottom+i-h;return this.addPadding(Math.max(m,0),Math.max(v,0),Math.max(x,0),Math.max(P,0)),this.scroll(t,i,e),this},centerContent:function(t){return this.positionContent("center",t)},centerElement:function(t,i){return this.checkElement(t,"centerElement"),this.positionElement(t,"center",i)},positionContent:function(t,i){var n=this.options.paper.getContentArea();return this.positionRect(n,t,i)},positionElement:function(t,i,n){this.checkElement(t,"positionElement");var e=t.getBBox();return this.positionRect(e,i,n)},positionRect:function(t,i,n){var e;switch(i){case"center":return e=t.center(),this.positionPoint(e,"50%","50%",n);case"top":return e=t.topMiddle(),this.positionPoint(e,"50%",0,n);case"top-right":return e=t.topRight(),this.positionPoint(e,"100%",0,n);case"right":return e=t.rightMiddle(),this.positionPoint(e,"100%","50%",n);case"bottom-right":return e=t.bottomRight(),this.positionPoint(e,"100%","100%",n);case"bottom":return e=t.bottomMiddle(),this.positionPoint(e,"50%","100%",n);case"bottom-left":return e=t.bottomLeft(),this.positionPoint(e,0,"100%",n);case"left":return e=t.leftMiddle(),this.positionPoint(e,0,"50%",n);case"top-left":return e=t.topLeft(),this.positionPoint(e,0,0,n);default:throw new Error("Provided positionName ('"+i+"') was not recognized.")}},positionPoint:function(t,i,n,e){e=e||{};var s=b.util.normalizeSides(e.padding),o=new b.g.Rect(this.getClientSize()),r=o.clone().moveAndExpand({x:s.left,y:s.top,width:-s.right-s.left,height:-s.top-s.bottom}),a=b.util.isPercentage(i);i=parseFloat(i),a&&(i=i/100*Math.max(0,r.width)),i<0&&(i=r.width+i);var h=b.util.isPercentage(n);n=parseFloat(n),h&&(n=n/100*Math.max(0,r.height)),n<0&&(n=r.height+n);var l=r.origin().offset(i,n),c=o.center().difference(l),p=this.zoom(),d=c.scale(1/p,1/p),u=t.clone().offset(d);return this.center(u.x,u.y,e)},scroll:function(t,i,n){var e=this.options.paper.matrix(),s=this.getClientSize(),o={};if(b.util.isNumber(t)){var r=s.width/2;o.scrollLeft=t-r+e.e+(this._padding.left||0)}if(b.util.isNumber(i)){var a=s.height/2;o.scrollTop=i-a+e.f+(this._padding.top||0)}n&&n.animation?this.$el.animate(o,n.animation):this.$el.prop(o)},scrollToContent:function(t){var i=this.options.paper.getContentArea().center(),n=this._sx,e=this._sy;return i.x*=n,i.y*=e,this.scroll(i.x,i.y,t)},scrollToElement:function(t,i){this.checkElement(t,"scrollToElement");var n=t.getBBox().center(),e=this._sx,s=this._sy;return n.x*=e,n.y*=s,this.scroll(n.x,n.y,i)},addPadding:function(t,i,n,e){var s=this.getPadding(),o=this._padding={left:Math.round(s.left+(t||0)),top:Math.round(s.top+(n||0)),bottom:Math.round(s.bottom+(e||0)),right:Math.round(s.right+(i||0))};return this.$background.css({width:o.left+this.options.paper.options.width+o.right,height:o.top+this.options.paper.options.height+o.bottom}),this.options.paper.$el.css({left:o.left,top:o.top}),this},zoom:function(t,i){if(void 0===t)return this._sx;i=i||{};var n,e,s=this.getClientSize(),o=this.clientToLocalPoint(s.width/2,s.height/2),r=t,a=t;if(i.absolute||(r+=this._sx,a+=this._sy),i.grid&&(r=Math.round(r/i.grid)*i.grid,a=Math.round(a/i.grid)*i.grid),i.max&&(r=Math.min(i.max,r),a=Math.min(i.max,a)),i.min&&(r=Math.max(i.min,r),a=Math.max(i.min,a)),void 0===i.ox||void 0===i.oy)n=o.x,e=o.y;else{var h=r/this._sx,l=a/this._sy;n=i.ox-(i.ox-o.x)/h,e=i.oy-(i.oy-o.y)/l}return this.beforePaperManipulation(),this.options.paper.scale(r,a),this.center(n,e),this.afterPaperManipulation(),this},zoomToFit:function(t){t=t||{};var i=this.options.paper,n=b.util.assign({},i.options.origin);return t.fittingBBox=t.fittingBBox||b.util.assign({},new b.g.Point(n),{width:this.$el.width(),height:this.$el.height()}),this.beforePaperManipulation(),i.scaleContentToFit(t),i.setOrigin(n.x,n.y),this.adjustPaper().centerContent(),this.afterPaperManipulation(),this},transitionClassName:"transition-in-progress",transitionEventName:"transitionend.paper-scroller-transition",transitionToPoint:function(t,i,n){b.util.isObject(t)&&(n=i,i=t.y,t=t.x),n=n||{};var e,s,o=this._sx,r=Math.max(n.scale||o,1e-6),a=this.getClientSize(),h=new b.g.Point(t,i),l=this.clientToLocalPoint(a.width/2,a.height/2);if(o===r){var c=l.difference(h).scale(o,o).round();e="translate("+c.x+"px,"+c.y+"px)"}else{var p=r/(o-r)*h.distance(l),d=l.clone().move(h,p),u=this.localToBackgroundPoint(d).round();e="scale("+r/o+")",s=u.x+"px "+u.y+"px"}return this.$el.addClass(this.transitionClassName),this.$background.off(this.transitionEventName).on(this.transitionEventName,function(t){var i=this.paperScroller;i.syncTransition(this.scale,{x:this.x,y:this.y});var n=this.onTransitionEnd;b.util.isFunction(n)&&n.call(i,t)}.bind({paperScroller:this,scale:r,x:t,y:i,onTransitionEnd:n.onTransitionEnd})).css({transition:"transform",transitionDuration:n.duration||"1s",transitionDelay:n.delay,transitionTimingFunction:n.timingFunction,transformOrigin:s,transform:e}),this},syncTransition:function(t,i){return this.beforePaperManipulation(),this.options.paper.scale(t),this.removeTransition().center(i.x,i.y),this.afterPaperManipulation(),this},removeTransition:function(){return this.$el.removeClass(this.transitionClassName),this.$background.off(this.transitionEventName).css({transition:"",transitionDuration:"",transitionDelay:"",transitionTimingFunction:"",transform:"",transformOrigin:""}),this},transitionToRect:function(t,i){t=new b.g.Rect(t);var n=(i=i||{}).maxScale||1/0,e=i.minScale||Number.MIN_VALUE,s=i.scaleGrid||null,o=i.visibility||1,r=i.center?new b.g.Point(i.center):t.center(),a=this.getClientSize(),h=a.width*o,l=a.height*o,c=new b.g.Rect({x:r.x-h/2,y:r.y-l/2,width:h,height:l}).maxRectUniformScaleToFit(t,r);return c=Math.min(c,n),s&&(c=Math.floor(c/s)*s),c=Math.max(e,c),this.transitionToPoint(r,b.util.defaults({scale:c},i))},startPanning:function(t){t=b.util.normalizeEvent(t),this._clientX=t.clientX,this._clientY=t.clientY,this.$el.addClass("is-panning"),this.trigger("pan:start",t),n(document.body).on({"mousemove.panning touchmove.panning":this.pan,"mouseup.panning touchend.panning":this.stopPanning}),n(window).on("mouseup.panning",this.stopPanning)},pan:function(t){var i=(t=b.util.normalizeEvent(t)).clientX-this._clientX,n=t.clientY-this._clientY;this.el.scrollTop-=n,this.el.scrollLeft-=i,this._clientX=t.clientX,this._clientY=t.clientY},stopPanning:function(t){n(document.body).off(".panning"),n(window).off(".panning"),this.$el.removeClass("is-panning"),this.trigger("pan:stop",t)},getClientSize:function(){return{width:this.el.clientWidth,height:this.el.clientHeight}},getPadding:function(){var t=this.options.padding;return b.util.isFunction(t)&&(t=t.call(this)),b.util.normalizeSides(t)},getVisibleArea:function(){var t=this.options.paper.matrix(),i=this.getClientSize(),n={x:this.el.scrollLeft||0,y:this.el.scrollTop||0,width:i.width,height:i.height},e=b.V.transformRect(n,t.inverse());return e.x-=(this._padding.left||0)/this._sx,e.y-=(this._padding.top||0)/this._sy,new b.g.Rect(e)},isElementVisible:function(t,i){this.checkElement(t,"isElementVisible");var n=(i=i||{}).strict?"containsRect":"intersect";return!!this.getVisibleArea()[n](t.getBBox())},isPointVisible:function(t){return this.getVisibleArea().containsPoint(t)},checkElement:function(t,i){if(!(t&&t instanceof b.dia.Element))throw new TypeError("ui.PaperScroller."+i+"() accepts instance of dia.Element only")},onRemove:function(){this.stopPanning()}});b.env.addTest("msie",function(){var t=window.navigator.userAgent;return-1!==t.indexOf("MSIE")||-1!==t.indexOf("Trident")}),b.env.addTest("msedge",function(){return/Edge\/\d+/.test(window.navigator.userAgent)}),t.PaperScroller=i}(this.joint.ui=this.joint.ui||{},$,joint);