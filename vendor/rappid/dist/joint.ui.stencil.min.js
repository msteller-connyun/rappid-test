/*! Rappid v3.0.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-08-09 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


this.joint=this.joint||{},function(t,o,h,i,n){"use strict";o=o&&o.hasOwnProperty("default")?o.default:o;var e={options:function(){return{columnWidth:this.options.width/2-10,columns:2,rowHeight:80,resizeToFit:!0,dy:10,dx:10}},layoutGroup:function(t,e){var i=this.options.layout;if(e=e||{},!n.GridLayout)throw new Error("joint.ui.Stencil: joint.layout.GridLayout is not available.");n.GridLayout.layout(t,h.util.assign({},i,e.layout))}},s=h.mvc.View.extend({className:"stencil",events:{"click .btn-expand":"openGroups","click .btn-collapse":"closeGroups","click .groups-toggle > .group-label":"openGroups","click .group > .group-label":"onGroupLabelClick","touchstart .group > .group-label":"onGroupLabelClick","input .search":"onSearch","focusin .search":"pointerFocusIn","focusout .search":"pointerFocusOut"},documentEvents:{mousemove:"onDrag",touchmove:"onDrag",mouseup:"onDragEnd",touchend:"onDragEnd",touchcancel:"onDragEnd"},options:{width:200,height:800,label:"Stencil",groups:null,groupsToggleButtons:!1,dropAnimation:!1,search:null,layout:null,snaplines:null,scaleClones:!1,dragStartClone:function(t){return t.clone()},dragEndClone:function(t){return t.clone()},layoutGroup:null,paperOptions:null,paperDragOptions:null},DEFAULT_GROUP:"__default__",init:function(){this.setPaper(this.options.paperScroller||this.options.paper),this.graphs={},this.papers={},this.$groups={},this.onSearch=h.util.debounce(this.onSearch,200),this.delegateEvents(),this.initializeLayout()},initializeLayout:function(){var t=this.options.layout;t&&(h.util.isFunction(t)?this.layoutGroup=t:(this.layoutGroup=e.layoutGroup.bind(this),this.options.layout=h.util.isObject(t)?t:{},h.util.defaults(this.options.layout,e.options.call(this))))},setPaper:function(t){var e=this.options;if(t instanceof h.dia.Paper)e.paperScroller=null,e.paper=t,e.graph=t.model;else{if(!("function"==typeof i.PaperScroller&&t instanceof i.PaperScroller))throw new Error("Stencil: paper required");e.paperScroller=t,e.paper=t.options.paper,e.graph=t.options.paper.model}},renderContent:function(){return o("<div/>").addClass("content")},renderPaperDrag:function(){return o("<div/>").addClass("stencil-paper-drag")},renderSearch:function(){return o("<div/>").addClass("search-wrap").append(o("<input/>",{type:"search",placeholder:"search"}).addClass("search"))},renderToggleAll:function(){return[o("<div/>").addClass("groups-toggle").append(o("<label/>").addClass("group-label").html(this.options.label)).append(o("<button/>",{text:"+"}).addClass("btn btn-expand")).append(o("<button/>",{text:"-"}).addClass("btn btn-collapse"))]},renderElementsContainer:function(){return o("<div/>").addClass("elements")},renderGroup:function(t){t=t||{};var e=o("<div/>").addClass("group").attr("data-name",t.name).toggleClass("closed",!!t.closed),i=o("<h3/>").addClass("group-label").html(t.label||t.name),n=this.renderElementsContainer();return e.append(i,n)},render:function(){var s=this.options;this.$content=this.renderContent(),this.$paperDrag=this.renderPaperDrag(),this.$el.empty().append(this.$paperDrag,this.$content),s.search&&this.$el.addClass("searchable").prepend(this.renderSearch()),s.groupsToggleButtons&&this.$el.addClass("collapsible").prepend(this.renderToggleAll());var r,t=Object.keys(s.groups||{}),e=0<t.length;if(s.paperOptions&&!h.util.isFunction(s.paperOptions)&&s.paperOptions.model)throw new Error("ui.Stencil: the `paperOptions` has to be a function if there is the property `model` defined.");if(e){h.util.sortBy(t,function(t){return this[t].index}.bind(s.groups)).forEach(function(t){var e=this.options.groups[t],i=this.$groups[t]=this.renderGroup({name:t,label:e.label,closed:e.closed}).appendTo(this.$content);if(e.paperOptions&&e.paperOptions.model)throw new Error("ui.Stencil: the `model` property is not allowed in the `paperOptions` for the groups.");r=h.util.result(s,"paperOptions")||{};var n=h.util.assign({},r,e.paperOptions,{el:i.find(".elements"),model:r.model||new h.dia.Graph,width:e.width||s.width,height:e.height||s.height,interactive:!1,preventDefaultBlankAction:!1}),o=new h.dia.Paper(n);this.graphs[t]=n.model,this.papers[t]=o},this)}else{var i=this.renderElementsContainer().appendTo(this.$content);r=h.util.result(s,"paperOptions")||{};var n=new h.dia.Paper(h.util.assign({},r,{el:i,model:r.model||new h.dia.Graph,width:s.width,height:s.height,interactive:!1,preventDefaultBlankAction:!1}));this.graphs[this.DEFAULT_GROUP]=n.model,this.papers[this.DEFAULT_GROUP]=n}r=h.util.result(s,"paperOptions")||{};var o=h.util.result(s,"paperDragOptions")||{},a=this._graphDrag=o.model||r.model||new h.dia.Graph;return this._paperDrag=new h.dia.Paper(h.util.assign({},s.paperDragOptions,{el:this.$paperDrag,width:1,height:1,model:a})),this.startListening(),this},startListening:function(){this.stopListening(),h.util.forIn(this.papers,function(t){this.listenTo(t,"cell:pointerdown",this.onDragStart)}.bind(this))},load:function(i,t){Array.isArray(i)?this.loadGroup(i,t):h.util.isObject(i)&&h.util.forIn(this.options.groups,function(t,e){i[e]&&this.loadGroup(i[e],e)}.bind(this))},loadGroup:function(t,e){var i=this.getGraph(e);i.resetCells(t);var n=this.options.height;if(e&&(n=this.getGroup(e).height),this.isLayoutEnabled()&&this.layoutGroup(i,this.getGroup(e)),!n){var o=this.getPaper(e);o.fitToContent({minWidth:o.options.width,gridHeight:1,padding:this.options.paperPadding||10})}},isLayoutEnabled:function(){return!!this.options.layout},getGraph:function(t){var e=this.graphs[t||this.DEFAULT_GROUP];if(!e)throw new Error("Stencil: group "+t+" does not exist.");return e},getPaper:function(t){return this.papers[t||this.DEFAULT_GROUP]},preparePaperForDragging:function(t,e,i){var n=this._paperDrag,o=this._graphDrag;n.$el.addClass("dragging").appendTo(document.body);var s=this.options.dragStartClone(t.model).position(0,0),r=5,a=this.options.snaplines;if(a&&(r+=a.options.distance),a||this.options.scaleClones){var l=this.options.paper.scale();n.scale(l.sx,l.sy),r*=Math.max(l.sx,l.sy)}else n.scale(1,1);this.clearClone(),this.options.dropAnimation&&this._paperDrag.$el.stop(!0,!0),o.resetCells([s.position(0,0)]);var p=s.findView(n);p.stopListening(),n.fitToContent({padding:r,allowNewOrigin:"any"});var h=p.getBBox(),u=this._cloneGeometryBBox=p.getBBox({useModelGeometry:!0});this._cloneViewDeltaOrigin=u.origin().difference(h.origin()),this._cloneBBox=s.getBBox(),this._clone=s,this._cloneView=p,this._paperDragPadding=r,this._paperDragInitialOffset=this.setPaperDragOffset(e,i)},setPaperDragOffset:function(t,e){var i=document.body.scrollTop||document.documentElement.scrollTop,n=this._cloneViewDeltaOrigin,o=this._cloneGeometryBBox,s=this._paperDragPadding||5,r={left:t-n.x-o.width/2-s,top:e-n.y-o.height/2-s+i};return this._paperDrag.$el.offset(r),r},setCloneLocalPosition:function(t,e){var i=this.options.paper.clientToLocalPoint({x:t,y:e}),n=this._cloneBBox;return i.x-=n.width/2,i.y-=n.height/2,this._clone.set("position",i),i},onDragStart:function(t,e){e.preventDefault(),this.options.graph.startBatch("stencil-drag"),this.$el.addClass("dragging"),this.preparePaperForDragging(t,e.clientX,e.clientY);var i=this.setCloneLocalPosition(e.clientX,e.clientY),n=this._cloneView,o=this.options.snaplines;o&&(o.captureCursorOffset(this._cloneView,e,i.x,i.y),n.listenTo(this._clone,"change:position",this.onCloneSnapped.bind(this))),this.delegateDocumentEvents(null,e.data)},onCloneSnapped:function(t,e,i){if(i.snapped){var n=this._cloneBBox;t.position(n.x+i.tx,n.y+i.ty,{silent:!0}),this._cloneView.translate(),t.set("position",e,{silent:!0}),this._cloneSnapOffset={x:i.tx,y:i.ty}}else this._cloneSnapOffset=null},onDrag:function(t){var e=this._cloneView;if(e){t.preventDefault();var i=(t=h.util.normalizeEvent(t)).clientX,n=t.clientY;this.setPaperDragOffset(i,n);var o=this.setCloneLocalPosition(i,n),s=this.options.paper.options.embeddingMode,r=this.options.snaplines,a=(s||r)&&this.insideValidArea({x:i,y:n});if(s){e.eventData(t,{paper:this.options.paper});var l=e.eventData(t);a?e.processEmbedding(l):e.clearEmbedding(l)}r&&(a?r.snapWhileMoving(e,t,o.x,o.y):r.hide())}},onDragEnd:function(t){var e=this._clone;if(e){t=h.util.normalizeEvent(t);var i=this._cloneView,n=this._cloneBBox,o=this._cloneSnapOffset,s=n.x,r=n.y;o&&(s+=o.x,r+=o.y),e.position(s,r,{silent:!0});var a=this.options.dragEndClone(e);this.drop(a,{x:t.clientX,y:t.clientY})?this.onDropEnd(e):this.onDropInvalid(t,a),this.options.paper.options.embeddingMode&&i&&(i.eventData(t,{model:a,paper:this.options.paper}),i.finalizeEmbedding(i.eventData(t))),this.options.graph.stopBatch("stencil-drag")}},onDropEnd:function(t){this._clone===t&&(this.clearClone(),this.$el.append(this._paperDrag.$el),this.$el.removeClass("dragging"),this._paperDrag.$el.removeClass("dragging"))},clearClone:function(){this._clone&&(this._clone.remove(),this._clone=null,this._cloneView=null,this._cloneSnapOffset=null,this._paperDragInitialOffset=null,this._paperDragPadding=null)},onDropInvalid:function(t,e){var i=this._clone;if(i){t=h.util.normalizeEvent(t),e=e||this.options.dragEndClone(i),this.trigger("drop:invalid",t,e);var n=this.options.dropAnimation;if(n){var o=h.util.isObject(n)?n.duration:150,s=h.util.isObject(n)?n.easing:"swing";this._cloneView=null,this._paperDrag.$el.animate(this._paperDragInitialOffset,o,s,this.onDropEnd.bind(this,i))}else this.onDropEnd(i)}},insideValidArea:function(t){var e,i=this.options.paper,n=this.options.paperScroller,o=this.getDropArea(this.$el);if(n)if(n.options.autoResizePaper)e=this.getDropArea(n.$el);else{var s=this.getDropArea(n.$el);e=this.getDropArea(i.$el).intersect(s)}else e=this.getDropArea(i.$el);return!(!e||!e.containsPoint(t)||o.containsPoint(t))},getDropArea:function(t){var e=t.offset(),i=document.body.scrollTop||document.documentElement.scrollTop,n=document.body.scrollLeft||document.documentElement.scrollLeft;return h.g.rect({x:e.left+parseInt(t.css("border-left-width"),10)-n,y:e.top+parseInt(t.css("border-top-width"),10)-i,width:t.innerWidth(),height:t.innerHeight()})},drop:function(t,e){var i=this.options.paper,n=this.options.graph;if(this.insideValidArea(e)){var o=i.clientToLocalPoint(e),s=t.getBBox();o.x+=s.x-s.width/2,o.y+=s.y-s.height/2;var r=this._cloneSnapOffset?1:i.options.gridSize;return t.set("position",{x:h.g.snapToGrid(o.x,r),y:h.g.snapToGrid(o.y,r)}),t.unset("z"),n.addCell(t,{stencil:this.cid}),!0}return!1},filter:function(l,p){var t=Object.keys(this.papers).reduce(function(t,e){var n=this.papers[e],o=e===this.DEFAULT_GROUP?null:e,i=n.model.getCells().filter(function(t){var e=!1;e=h.util.isFunction(p)?p.call(this,t,l,o,this):this.isCellMatched(t,l,p,l.toLowerCase()!==l);var i=n.findViewByModel(t);return i&&i.vel.toggleClass("unmatched",!e),e}.bind(this)),s=!h.util.isEmpty(i),r=this.options,a=((h.util.result(r,"paperOptions")||{}).model||new h.dia.Graph).resetCells(i);return this.trigger("filter",a,e,l),this.isLayoutEnabled()&&this.layoutGroup(a,this.getGroup(e)),this.$groups[e]&&this.$groups[e].toggleClass("unmatched",!s),n.fitToContent({gridWidth:1,gridHeight:1,padding:r.paperPadding||10}),t||s}.bind(this),!1);this.$el.toggleClass("not-found",!t)},isCellMatched:function(i,n,o,s){return!n||Object.keys(o).some(function(t){var e=o[t];return("*"==t||i.get("type")==t)&&e.some(function(t){var e=h.util.getByPath(i.attributes,t,"/");return null!=e&&(e=e.toString(),s||(e=e.toLowerCase()),0<=e.indexOf(n))})})},getGroup:function(t){return this.options.groups&&this.options.groups[t]||{}},onSearch:function(t){this.filter(t.target.value,this.options.search)},pointerFocusIn:function(){this.$el.addClass("is-focused")},pointerFocusOut:function(){this.$el.removeClass("is-focused")},onGroupLabelClick:function(t){if("touchstart"===t.type)this._groupLabelClicked=!0;else if(this._groupLabelClicked&&"click"===t.type)return void(this._groupLabelClicked=!1);var e=o(t.target).closest(".group");this.toggleGroup(e.data("name"))},toggleGroup:function(t){this.isGroupOpen(t)?this.closeGroup(t):this.openGroup(t)},closeGroup:function(t){var e=this.$groups[t];e&&this.isGroupOpen(t)&&(this.trigger("group:close",t),e.addClass("closed"))},openGroup:function(t){var e=this.$groups[t];e&&!this.isGroupOpen(t)&&(this.trigger("group:open",t),e.removeClass("closed"))},isGroupOpen:function(t){var e=this.$groups[t];return!!e&&!e.hasClass("closed")},closeGroups:function(){Object.keys(this.$groups).forEach(function(t){this.closeGroup(t)},this)},openGroups:function(){Object.keys(this.$groups).forEach(function(t){this.openGroup(t)},this)},onRemove:function(){h.util.invoke(this.papers,"remove"),this.papers={},this._paperDrag&&(this._paperDrag.remove(),this._paperDrag=null),this.undelegateDocumentEvents()}});t.Stencil=s}(this.joint.ui=this.joint.ui||{},$,joint,joint.ui,joint.layout);