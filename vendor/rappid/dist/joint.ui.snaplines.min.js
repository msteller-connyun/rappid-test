/*! Rappid v3.0.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-08-09 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


this.joint=this.joint||{},function(t,e,E){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var i=E.mvc.View.extend({options:{paper:void 0,distance:10},className:"snaplines",documentEvents:{mouseup:"hide",touchend:"hide"},init:function(){E.util.bindAll(this,"hide"),this.render(),this.startListening(),this.prepareFilters()},render:function(){var t=this.$horizontal=e("<div>").addClass("snapline horizontal"),i=this.$vertical=e("<div>").addClass("snapline vertical");this.$el.hide().append([t,i]).appendTo(this.options.paper.el)},startListening:function(){this.stopListening(),this.listenTo(this.options.paper,"element:pointerdown",this.captureCursorOffset),this.listenTo(this.options.paper,"element:pointermove",this.snapWhileMoving),this.listenTo(this.options.paper.model,"batch:stop",this.onBatchStop),this.delegateDocumentEvents()},prepareFilters:function(){this.filterTypes={},this.filterCells={},this.filterFunction=void 0,Array.isArray(this.options.filter)?this.options.filter.forEach(function(t){E.util.isString(t)?this.filterTypes[t]=!0:this.filterCells[t.id]=!0},this):E.util.isFunction(this.options.filter)&&(this.filterFunction=this.options.filter)},onBatchStop:function(t){"resize"===(t=t||{}).batchName&&this.snapWhileResizing(t.cell,t)},captureCursorOffset:function(t,i,e,n){var s=t.getDelegatedView();if(s&&this.canElementMove(s)){var o=s.model.get("position");this._cursorOffset={x:e-o.x,y:n-o.y}}},snapWhileResizing:function(o,t){if(t.ui&&!t.snapped&&t.direction&&t.trueDirection){var i=this.options.paper.findViewByModel(o);if(i&&i.model.isElement()){var e=o.getBBox(),n=e.bbox(o.get("angle")),s=n.origin(),r=n.corner(),a=E.g.normalizeAngle(o.get("angle")),h=this.options.distance,l=null,c=null,u={vertical:0,horizontal:0},p=t.direction,d=t.trueDirection,f=t.relativeDirection;if(-1!==d.indexOf("right")?u.vertical=r.x:u.vertical=s.x,-1!==d.indexOf("bottom")?u.horizontal=r.y:u.horizontal=s.y,this.options.paper.model.getElements().find(function(t){if(t.id===o.id||t.isEmbeddedIn(o)||this.filterTypes[t.get("type")]||this.filterCells[t.id]||this.filterFunction&&this.filterFunction(t))return!1;var i=t.getBBox().bbox(t.get("angle")),e=i.origin(),n=i.corner(),s={vertical:[e.x,n.x],horizontal:[e.y,n.y]};return E.util.forIn(s,function(t,i){t=(t=t.map(function(t){return{position:t,distance:Math.abs(t-u[i])}})).filter(function(t){return t.distance<h}),t=E.util.sortBy(t,function(t){return t.distance}),s[i]=t}),null===l&&0<s.vertical.length&&(l=s.vertical[0].position),null===c&&0<s.horizontal.length&&(c=s.horizontal[0].position),E.util.isNumber(l)&&E.util.isNumber(c)},this),this.hide(),E.util.isNumber(l)||E.util.isNumber(c)){var g=0;E.util.isNumber(l)&&(g=-1!==d.indexOf("right")?l-n.corner().x:n.origin().x-l);var m=0;E.util.isNumber(c)&&(m=-1!==d.indexOf("bottom")?c-n.corner().y:n.origin().y-c);var x=0,v=0;if(!(a%90))v=90===a||270===a?(x=m,g):(x=g,m);else{var b;b=0<=a&&a<90?1:90<=a&&a<180?4:180<=a&&a<270?3:2,c&&l&&(g<m?(m=0,c=null):(g=0,l=null));var y=E.g.toRad(a%90);g&&(x=3===b?g/Math.cos(y):g/Math.sin(y)),m&&(v=3===b?m/Math.cos(y):m/Math.sin(y));var M=1===b||3===b;switch(f){case"top":case"bottom":v=m?m/(M?Math.cos(y):Math.sin(y)):g/(M?Math.sin(y):Math.cos(y));break;case"left":case"right":x=g?g/(M?Math.cos(y):Math.sin(y)):m/(M?Math.sin(y):Math.cos(y))}}switch(f){case"top":case"bottom":x=0;break;case"left":case"right":v=0}var w=this.options.paper.options.gridSize,z=Math.max(e.width+x,w),N=Math.max(e.height+v,w);t.minWidth&&t.minWidth>w&&(z=Math.max(z,t.minWidth)),t.minHeight&&t.minHeight>w&&(N=Math.max(N,t.minHeight)),t.maxWidth&&(z=Math.min(z,t.maxWidth)),t.maxHeight&&(N=Math.min(N,t.maxHeight)),t.preserveAspectRatio&&(v<x?N=z*(e.height/e.width):z=N*(e.width/e.height)),z===e.width&&N===e.height||o.resize(z,N,{snaplines:this.cid,restrictedArea:this.options.paper.getRestrictedArea(i),direction:p,relativeDirection:f,trueDirection:d,snapped:!0});var B=o.getBBox().bbox(a);l&&1<Math.abs(B.x-l)&&1<Math.abs(B.width+B.x-l)&&(l=null),c&&1<Math.abs(B.y-c)&&1<Math.abs(B.height+B.y-c)&&(c=null),this.show({vertical:l,horizontal:c})}}}},canElementMove:function(t){return t&&t.model.isElement()&&t.can("elementMove")},snapWhileMoving:function(t,i,e,n){var s=t.eventData(i).delegatedView||t;if(this.canElementMove(s)){var o=s.model,r=o.get("position"),a=o.get("size"),h=E.g.rect(E.util.assign({x:e-this._cursorOffset.x,y:n-this._cursorOffset.y},a)),l=h.center(),c=h.bbox(o.get("angle")),u=c.origin(),p=c.corner(),d=this.options.distance,f=null,g=null,m=0,x=0;if(this.options.paper.model.getElements().find(function(t){if(t===o||t.isEmbeddedIn(o)||this.filterTypes[t.get("type")]||this.filterCells[t.id]||this.filterFunction&&this.filterFunction(t))return!1;var i=t.getBBox().bbox(t.get("angle")),e=i.center(),n=i.origin(),s=i.corner();return null===f&&(Math.abs(e.x-l.x)<d?(f=e.x,m=.5):Math.abs(n.x-u.x)<d?f=n.x:Math.abs(n.x-p.x)<d?(f=n.x,m=1):Math.abs(s.x-p.x)<d?(f=s.x,m=1):Math.abs(s.x-u.x)<d&&(f=s.x)),null===g&&(Math.abs(e.y-l.y)<d?(g=e.y,x=.5):Math.abs(n.y-u.y)<d?g=n.y:Math.abs(n.y-p.y)<d?(g=n.y,x=1):Math.abs(s.y-p.y)<d?(g=s.y,x=1):Math.abs(s.y-u.y)<d&&(g=s.y)),E.util.isNumber(f)&&E.util.isNumber(g)},this),this.hide(),E.util.isNumber(f)||E.util.isNumber(g)){E.util.isNumber(f)&&(c.x=f-m*c.width),E.util.isNumber(g)&&(c.y=g-x*c.height);var v=c.center(),b=v.x-h.width/2,y=v.y-h.height/2;o.translate(b-r.x,y-r.y,{restrictedArea:this.options.paper.getRestrictedArea(s),snapped:!0}),this.show({vertical:f,horizontal:g})}}},show:function(t){t=t||{};var i=this.options.paper.matrix();t.horizontal?this.$horizontal.css("top",t.horizontal*i.d+i.f).show():this.$horizontal.hide(),t.vertical?this.$vertical.css("left",t.vertical*i.a+i.e).show():this.$vertical.hide(),this.$el.show()},hide:function(){this.$el.hide()}});t.Snaplines=i}(this.joint.ui=this.joint.ui||{},$,joint);