/*! Rappid v3.0.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-08-09 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


this.joint=this.joint||{},function(t,a,h){"use strict";a=a&&a.hasOwnProperty("default")?a.default:a;var e=h.mvc.View.extend({className:"select-box",events:{"click .select-box-selection":"onToggle"},options:{options:[],width:void 0,openPolicy:"auto",target:null,keyboardNavigation:!0,selected:void 0,selectBoxOptionsClass:void 0,disabled:!1},init:function(){this.options.target=this.options.target||document.body,h.util.bindAll(this,"onOutsideClick","onOptionSelect"),a(document).on("click.selectBox",this.onOutsideClick),this.$el.data("view",this),void 0===this.options.selected?this.selection=h.util.toArray(this.options.options).find(function(t){return!0===t.selected})||this.options.options[0]:this.selection=this.options.options[this.options.selected]},render:function(){return this.$el.empty(),this.$selection=null,this.renderSelection(this.selection),this.options.width&&this.$el.css("width",this.options.width),this.options.disabled&&this.disable(),this.$el.append(this.$options),this},renderOptions:function(){this.removeOptions();var t=this.options,e={selectBoxView:this,parentClassName:h.util.result(this,"className")||null,extraClassName:h.util.result(t,"selectBoxOptionsClass")||null,options:t.options};t.width&&(e.width=t.width),t.theme&&(e.theme=t.theme);var i=this.optionsView=new this.constructor.OptionsView(e);i.render(),this.listenTo(i,"option:select",this.onOptionSelect),this.listenTo(i,"option:hover",this.onOptionHover),this.listenTo(i,"options:mouseout",this.onOptionsMouseOut),this.$options=i.$el,this.$optionsArrow=i.$arrow,this.$target=a(t.target)},onOptionHover:function(t,e){this.trigger("option:hover",t,e)},onOptionsMouseOut:function(t){this.trigger("options:mouseout",t)},onOptionSelect:function(t,e){this.select(t,e)},removeOptions:function(){this.optionsView&&(this.stopListening(this.optionsView),this.optionsView.remove(),this.optionsView=null)},renderSelection:function(t){if(this.$selection||(this.$selection=a("<div/>",{class:"select-box-selection"}),this.$el.append(this.$selection)),this.$selection.empty(),t){var e=this.constructor.OptionsView.prototype.renderOptionContent.call(void 0,t);this.$selection.append(e)}else if(this.options.placeholder){var i=a("<div/>",{class:"select-box-placeholder",html:this.options.placeholder});this.$selection.append(i)}},onToggle:function(t){this.toggle()},onOutsideClick:function(t){!this.el.contains(t.target)&&this.$el.hasClass("opened")&&this.close()},getSelection:function(){return this.selection},getSelectionValue:function(t){return(t=t||this.selection)&&(void 0===t.value?t.content:t.value)},getSelectionIndex:function(){return h.util.toArray(this.options.options).findIndex(function(t){return t===this.selection}.bind(this))},select:function(t,e){this.selection=this.options.options[t],this.renderSelection(this.selection),this.trigger("option:select",this.selection,t,e),this.close()},selectByValue:function(t,e){for(var i=this.options.options||[],o=0;o<i.length;o++){var s=i[o];if(void 0===s.value&&s.content===t)return this.select(o,e);if(void 0!==s.value&&h.util.isEqual(s.value,t))return this.select(o,e)}},isOpen:function(){return this.$el.hasClass("opened")},toggle:function(){this.isOpen()?this.close():this.open()},position:function(){var t=this.$(".select-box-selection"),e=t.outerHeight(),i=t.offset(),o=i.left,s=i.top,n=this.$options.outerHeight(),l={left:0,top:0};this.options.target!==document.body?((l=this.$target.offset()).width=this.$target.outerWidth(),l.height=this.$target.outerHeight(),l.left-=this.$target.scrollLeft(),l.top-=this.$target.scrollTop()):(l.width=a(window).width(),l.height=a(window).height());var h=o,r="auto",c=this.options.openPolicy;switch("selected"!==c||this.selection||(c="auto"),c){case"above":r=s-n;break;case"coverAbove":r=s-n+e;break;case"below":r=s+e;break;case"coverBelow":r=s;break;case"selected":r=s-this.$options.find(".selected").position().top;break;default:r=s-this.$target.scrollTop()+n>l.top+l.height?s-n+e:s}h-=l.left,r-=l.top,this.$options.css({left:h,top:r})},open:function(){this.isDisabled()||(this.renderOptions(),this.$options.appendTo(this.options.target),this.$options.addClass("rendered"),this.position(),this.$el.addClass("opened"),this.respectWindowBoundaries(),this.alignOptionsArrow())},respectWindowBoundaries:function(){var t=this.calculateElOverflow(this.$options),e={left:0,top:0};this.$options.outerWidth()<=this.$target.innerWidth()&&(t.left&&t.right||(t.left?e.left=t.left:t.right&&(e.left=-t.right))),this.$options.outerHeight()<=this.$target.innerHeight()&&(t.top&&t.bottom||(t.top?e.top=t.top:t.bottom&&(e.top=-t.bottom))),this.$options.css({left:"+="+e.left,top:"+="+e.top})},alignOptionsArrow:function(){var t=this.$el[0].getBoundingClientRect(),e=this.$options[0].getBoundingClientRect(),i=t.left+t.width/2;i-=e.left,i-=this.$optionsArrow.outerWidth()/2,this.$optionsArrow.css({left:i})},close:function(){this.removeOptions(),this.$el.removeClass("opened"),this.trigger("close")},onRemove:function(){this.removeOptions(),a(document).off(".selectBox",this.onOutsideClick)},isDisabled:function(){return this.$el.hasClass("disabled")},enable:function(){this.$el.removeClass("disabled")},disable:function(){this.close(),this.$el.addClass("disabled")},onSetTheme:function(t,e){this.$options&&(t&&this.$options.removeClass(this.themeClassNamePrefix+t),this.$options.addClass(this.themeClassNamePrefix+e))},calculateElOverflow:function(t,e){e=e||window,t instanceof a&&(t=t[0]),e instanceof a&&(e=e[0]);var i,o={},s=t.getBoundingClientRect();if(e===window){var n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;i={width:n,height:l,left:0,top:0,right:n,bottom:l}}else i=e.getBoundingClientRect();return["left","top"].forEach(function(t){o[t]=Math.min(0,s[t]-i[t])}),["right","bottom"].forEach(function(t){o[t]=Math.min(0,i[t]-s[t])}),h.util.forIn(o,function(t,e){o[e]=Math.abs(Math.round(t))}),o}},{OptionsView:h.mvc.View.extend({events:{"mouseover .select-box-option":"onOptionHover","click .select-box-option":"onOptionClick"},className:function(){var t=["select-box-options"],e=this.options.parentClassName;return e&&t.push(e),t.join(" ")},init:function(){h.util.bindAll(this,"onMouseout","onKeydown"),a(document).on({"keydown.selectBoxOptions":this.onKeydown,"mouseleave.selectBoxOptions mouseout.selectBoxOptions":this.onMouseout})},render:function(){var t=this.options.extraClassName;return t&&this.$el.addClass(t),this.options.width&&this.$el.css("width",this.options.width),h.util.toArray(this.options.options).forEach(function(t,e){var i=this.renderOption(t,e);this.options.selectBoxView.selection===t&&i.addClass("selected hover"),this.$el.append(i)},this),this.$arrow=a("<div/>").addClass("select-box-options-arrow").appendTo(this.$el),this},renderOption:function(t,e){var i=this.renderOptionContent(t);return i.addClass("select-box-option"),i.data("index",e),i},renderOptionContent:function(t){var e=a("<div/>",{class:"select-box-option-content",html:t.content});return t.icon&&e.prepend(a("<img/>",{class:"select-box-option-icon",src:t.icon})),e},select:function(t,e){this.trigger("option:select",t,e)},hover:function(t){var e=this.options.options[t];this.markOptionHover(t),this.trigger("option:hover",e,t)},onOptionClick:function(t){var e=this.getOptionIndex(t.target);this.select(e,{ui:!0})},onOptionHover:function(t){var e=this.getOptionIndex(t.target);this.hover(e)},onMouseout:function(t){this.trigger("options:mouseout",t)},onKeydown:function(t){var e=this.options.selectBoxView;if(e.options.keyboardNavigation&&e.isOpen()){var i;switch(t.which){case 39:case 40:i=1;break;case 38:case 37:i=-1;break;case 13:var o=this.getOptionHoverIndex();return void(0<=o&&this.select(o));case 27:return e.close();default:return}t.preventDefault();var s=this.getOptionHoverIndex()+i,n=this.options.options;s<0&&(s=n.length-1),s>=n.length&&(s=0),this.hover(s)}},onRemove:function(){a(document).off(".selectBoxOptions")},markOptionHover:function(t){this.$el.find(".hover").removeClass("hover"),a(this.$el.find(".select-box-option")[t]).addClass("hover")},getOptionHoverIndex:function(){return this.$el.find(".select-box-option.hover").index()},getOptionIndex:function(t){return a(t).closest(".select-box-option").data("index")}})});t.SelectBox=e}(this.joint.ui=this.joint.ui||{},$,joint);